<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platformer Duel - Extended</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #1a1a1a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            overflow: hidden;
        }

        .game-wrapper {
            position: relative; /* Důležité pro pozicování vítězné obrazovky */
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            border: 5px solid #444;
        }

        .header {
            position: absolute;
            top: -60px;
            width: 100%;
            text-align: center;
            pointer-events: none;
        }

        .controls-hint {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-weight: bold;
            text-shadow: 2px 2px 4px #000;
        }

        canvas {
            background-color: #87CEEB;
            display: block;
        }

        /* VYLEPŠENÁ OBRAZOVKA VÍTĚZSTVÍ (Místo alertu) */
        #winScreen {
            display: none; /* Skryté, dokud někdo nevyhraje */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        #winMessage {
            font-size: 3rem;
            margin-bottom: 20px;
            font-weight: bold;
            text-transform: uppercase;
        }

        button {
            padding: 15px 30px;
            font-size: 1.5rem;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            transition: transform 0.1s;
        }

        button:hover {
            transform: scale(1.05);
            background-color: #218838;
        }
    </style>
</head>
<body>

    <div class="game-wrapper">
        <div class="header">
            <div class="controls-hint">
                <span style="color: #ff4d4d;">PLAYER 1: W, A, D</span>
                <span style="color: #4d4dff;">PLAYER 2: Šipky</span>
            </div>
        </div>

        <canvas id="gameCanvas"></canvas>

        <div id="winScreen">
            <div id="winMessage">Hráč 1 vyhrál!</div>
            <button onclick="restartGame()">HRÁT ZNOVU</button>
        </div>
    </div>

    <script>
        window.onload = function() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const winScreen = document.getElementById('winScreen');
            const winMessage = document.getElementById('winMessage');

            // --- NASTAVENÍ HRY ---
            canvas.width = 900;  // Trochu širší pro lepší manévry
            canvas.height = 700; // Vyšší pro delší trasu

            const GRAVITY = 0.6; // Trochu těžší gravitace pro preciznější skoky
            const FRICTION = 0.85; 
            let gameRunning = true;

            const keys = {
                w: false, a: false, d: false,
                ArrowUp: false, ArrowLeft: false, ArrowRight: false
            };

            window.addEventListener('keydown', (e) => keys[e.key] = true);
            window.addEventListener('keyup', (e) => keys[e.key] = false);

            // --- TŘÍDY ---
            class Player {
                constructor(x, y, color, controls) {
                    this.startX = x; // Uložíme startovní pozici pro reset
                    this.startY = y;
                    this.x = x;
                    this.y = y;
                    this.w = 20; // MENŠÍ HRÁČ (bylo 30) -> těžší hra
                    this.h = 20; 
                    this.color = color;
                    this.velX = 0;
                    this.velY = 0;
                    this.speed = 4.5; // O něco pomalejší pro kontrolu
                    this.jumpStrength = 11.5;
                    this.grounded = false;
                    this.controls = controls;
                }

                update() {
                    if (!gameRunning) return; // Zastaví pohyb, když někdo vyhraje

                    // Pohyb
                    if (keys[this.controls.left]) {
                        if (this.velX > -this.speed) this.velX--;
                    }
                    if (keys[this.controls.right]) {
                        if (this.velX < this.speed) this.velX++;
                    }
                    if (keys[this.controls.up] && this.grounded) {
                        this.velY = -this.jumpStrength;
                        this.grounded = false;
                    }

                    // Fyzika
                    this.velX *= FRICTION;
                    this.velY += GRAVITY;
                    this.x += this.velX;
                    this.y += this.velY;
                    this.grounded = false;

                    // Kolize s plošinami
                    platforms.forEach(platform => {
                        const dir = colCheck(this, platform);
                        if (dir === "b") this.grounded = true;
                    });

                    // Hranice
                    if (this.x < 0) this.x = 0;
                    if (this.x + this.w > canvas.width) this.x = canvas.width - this.w;
                    
                    // Smrt pádem (reset na dno, ale nezabije hru)
                    if (this.y + this.h > canvas.height) { 
                        this.y = canvas.height - this.h;
                        this.grounded = true;
                        this.velY = 0;
                    }
                }

                draw() {
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.w, this.h);
                    ctx.strokeStyle = "white"; // Bílý obrys pro lepší viditelnost
                    ctx.lineWidth = 1;
                    ctx.strokeRect(this.x, this.y, this.w, this.h);
                }
                
                reset() {
                    this.x = this.startX;
                    this.y = this.startY;
                    this.velX = 0;
                    this.velY = 0;
                }
            }

            class Platform {
                constructor(x, y, w, h) {
                    this.x = x; this.y = y; this.w = w; this.h = h;
                }
                draw() {
                    ctx.fillStyle = "#5D4037"; // Tmavší hnědá
                    ctx.fillRect(this.x, this.y, this.w, this.h);
                    ctx.fillStyle = "#76FF03"; // Neonová tráva
                    ctx.fillRect(this.x, this.y, this.w, 4);
                }
            }

            class Goal {
                constructor(x, y) {
                    this.x = x; this.y = y; this.w = 30; this.h = 30;
                }
                draw() {
                    // Blikající efekt
                    ctx.fillStyle = Math.random() > 0.5 ? "#FFD700" : "#FFA500"; 
                    ctx.fillRect(this.x, this.y, this.w, this.h);
                    ctx.font = "10px Arial";
                    ctx.fillStyle = "black";
                    ctx.fillText("CÍL", this.x + 5, this.y + 20);
                }
            }

            // --- KOLIZE ---
            function colCheck(shapeA, shapeB) {
                const vX = (shapeA.x + (shapeA.w / 2)) - (shapeB.x + (shapeB.w / 2));
                const vY = (shapeA.y + (shapeA.h / 2)) - (shapeB.y + (shapeB.h / 2));
                const hWidths = (shapeA.w / 2) + (shapeB.w / 2);
                const hHeights = (shapeA.h / 2) + (shapeB.h / 2);
                let colDir = null;

                if (Math.abs(vX) < hWidths && Math.abs(vY) < hHeights) {
                    const oX = hWidths - Math.abs(vX);
                    const oY = hHeights - Math.abs(vY);
                    if (oX >= oY) {
                        if (vY > 0) { colDir = "t"; shapeA.y += oY; shapeA.velY = 0; }
                        else { colDir = "b"; shapeA.y -= oY; shapeA.velY = 0; }
                    } else {
                        if (vX > 0) { colDir = "l"; shapeA.x += oX; shapeA.velX = 0; }
                        else { colDir = "r"; shapeA.x -= oX; shapeA.velX = 0; }
                    }
                }
                return colDir;
            }

            // --- MAPA (DLOUHÁ A TĚŽŠÍ) ---
            const platforms = [];
            
            // 0. Země
            platforms.push(new Platform(0, 680, 900, 20)); 

            // 1. Patro - Rozjezd (Široké po stranách)
            platforms.push(new Platform(0, 590, 300, 15));
            platforms.push(new Platform(600, 590, 300, 15));

            // 2. Patro - Cesta ke středu (Užší)
            platforms.push(new Platform(350, 500, 200, 15));

            // 3. Patro - Rozskok do stran (Ostrůvky) - Díra uprostřed
            platforms.push(new Platform(150, 410, 150, 15));
            platforms.push(new Platform(600, 410, 150, 15));

            // 4. Patro - Dvojitý střed
            platforms.push(new Platform(300, 320, 100, 15));
            platforms.push(new Platform(500, 320, 100, 15));

            // 5. Patro - Těžké skoky na krajích
            platforms.push(new Platform(50, 230, 100, 15));
            platforms.push(new Platform(750, 230, 100, 15));

            // 6. Patro - Předfinální můstek
            platforms.push(new Platform(250, 140, 400, 15));

            // 7. Patro - Věžička pro cíl
            platforms.push(new Platform(420, 70, 60, 10));

            // Cíl (Úplně nahoře)
            const goal = new Goal(435, 30);

            // Hráči
            const player1 = new Player(50, 640, "#ff4d4d", {up: "w", left: "a", right: "d"});
            const player2 = new Player(830, 640, "#4d4dff", {up: "ArrowUp", left: "ArrowLeft", right: "ArrowRight"});

            // --- LOGIKA VÝHRY ---
            function triggerWin(winnerName, color) {
                if (!gameRunning) return; // Zabraní vícenásobnému spuštění
                gameRunning = false;
                
                winMessage.innerText = winnerName + " VYHRÁL!";
                winMessage.style.color = color;
                winScreen.style.display = "flex"; // Ukáže vítěznou obrazovku
            }

            // Tato funkce je volaná tlačítkem v HTML
            window.restartGame = function() {
                player1.reset();
                player2.reset();
                winScreen.style.display = "none";
                gameRunning = true;
                update(); // Znovu nastartuje smyčku
            };

            // --- HERNÍ SMYČKA ---
            function update() {
                if (!gameRunning) return; // Zastaví vykreslování, když je konec

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Vykreslení světa
                platforms.forEach(p => p.draw());
                goal.draw();
                
                // Kontrola výhry
                if (colCheck(player1, goal)) triggerWin("HRÁČ 1", "#ff4d4d");
                if (colCheck(player2, goal)) triggerWin("HRÁČ 2", "#4d4dff");

                // Update hráčů
                player1.update();
                player1.draw();
                player2.update();
                player2.draw();

                requestAnimationFrame(update);
            }

            update();
        };
    </script>
</body>
</html>
